const { Kafka } = require('kafkajs');

// ‚úÖ Kafka configuration
const kafka = new Kafka({
  clientId: 'burst-producer',
  brokers: ['localhost:9092']
});

const producer = kafka.producer();

// ‚úÖ 5 input topics
const inputTopics = [
  'input-topic-1',
  'input-topic-2',
  'input-topic-3',
  'input-topic-4',
  'input-topic-5'
];

// Generate random JSON record
function generateRecord(topic, i) {
  return {
    topic,
    key: `key-${Math.floor(Math.random() * 10)}`, // random key (0‚Äì9)
    value: JSON.stringify({
      id: i,
      message: `Test message ${i}`,
      timestamp: new Date().toISOString()
    })
  };
}

// Produce messages in burst mode
async function burstMessages() {
  let counter = 0;

  for (const topic of inputTopics) {
    const messages = [];

    // create 100 messages per topic per burst
    for (let i = 0; i < 100; i++) {
      messages.push({
        key: `key-${i % 10}`,
        value: JSON.stringify(generateRecord(topic, counter++))
      });
    }

    console.log(`üöÄ Producing ${messages.length} messages to ${topic}`);
    await producer.send({ topic, messages });
  }
}

async function main() {
  await producer.connect();

  console.log('üî• Burst producer started! Producing to 5 topics every 10 seconds...');

  // run burst every 10 seconds
  setInterval(async () => {
    try {
      await burstMessages();
    } catch (err) {
      console.error('‚ùå Error producing messages:', err);
    }
  }, 10_000);
}

main().catch(console.error);
